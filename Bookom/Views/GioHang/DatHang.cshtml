@using Bookom.Models
@model List<GioHang>

@{
    ViewBag.Title = "Thanh toán đơn hàng";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    /* Màu đặc trưng của MoMo */
    .btn-momo {
        background-color: #A50064;
        border-color: #A50064;
        color: white;
    }

        .btn-momo:hover {
            background-color: #c70078;
            color: white;
        }
</style>

<div class="container py-3">
    <div class="row">
        <div class="col-lg-7 mb-4">
            <div class="card shadow border-0 h-100">
                <div class="card-header bg-white py-3">
                    <h5 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-map-marker-alt mr-2"></i> THÔNG TIN GIAO HÀNG
                    </h5>
                </div>
                <div class="card-body">
                    @using (Html.BeginForm("DatHang", "GioHang", FormMethod.Post, new { id = "formDatHang" }))
                    {
                        <div class="form-group bg-light p-3 rounded border mb-4">
                            <label class="font-weight-bold text-dark mb-2">Bạn muốn giao hàng đến đâu?</label>

                            <div class="custom-control custom-radio mb-2">
                                <input type="radio" id="diaChiMacDinh" name="LoaiDiaChi" class="custom-control-input" checked onchange="chonDiaChi(1)">
                                <label class="custom-control-label" for="diaChiMacDinh">
                                    Dùng địa chỉ mặc định <span class="badge badge-success ml-2">Khuyên dùng</span>
                                </label>
                            </div>

                            <div class="custom-control custom-radio">
                                <input type="radio" id="diaChiMoi" name="LoaiDiaChi" class="custom-control-input" onchange="chonDiaChi(2)">
                                <label class="custom-control-label" for="diaChiMoi">
                                    Giao đến địa chỉ mới
                                </label>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label class="small font-weight-bold">Họ tên người nhận</label>
                                <input type="text" name="HoTenKH" id="HoTenKH" class="form-control" required value="@ViewBag.TenKH" readonly />
                            </div>
                            <div class="form-group col-md-6">
                                <label class="small font-weight-bold">Số điện thoại</label>
                                <input type="text" name="DienThoaiKH" id="DienThoaiKH" class="form-control" required value="@ViewBag.SDT" readonly />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="small font-weight-bold">Địa chỉ nhận hàng</label>
                            <input type="text" name="DiaChiKH" id="DiaChiKH" class="form-control" required value="@ViewBag.DiaChi" readonly />
                        </div>

                        <div class="form-group">
                            <label class="small font-weight-bold">Ghi chú (Tùy chọn)</label>
                            <textarea class="form-control" rows="2" placeholder="Lời nhắn cho shipper..."></textarea>
                        </div>

                        <hr class="my-4" />

                        <h5 class="font-weight-bold text-dark mb-3">CHỌN PHƯƠNG THỨC THANH TOÁN</h5>

                        <div class="row">
                            <div class="col-md-6 mb-2">
                                <button type="submit" name="paymentMethod" value="TienMat"
                                        class="btn btn-success btn-lg btn-block shadow-sm"
                                        onclick="return confirm('Xác nhận đặt hàng với hình thức Tiền Mặt?');">
                                    <i class="fas fa-money-bill-wave mr-2"></i> TIỀN MẶT (COD)
                                </button>
                            </div>

                            <div class="col-md-6 mb-2">
                                <button type="submit" name="paymentMethod" value="MoMo"
                                        class="btn btn-momo btn-lg btn-block shadow-sm"
                                        onclick="return confirm('Hệ thống sẽ chuyển sang MoMo để thanh toán. Bạn chắc chứ?');">
                                    <i class="fas fa-wallet mr-2"></i> VÍ MOMO
                                </button>
                            </div>
                        </div>

                        <div class="mt-3 text-center">
                            <a href="@Url.Action("GioHang", "GioHang")" class="text-secondary small">
                                <i class="fas fa-arrow-left mr-1"></i> Quay lại giỏ hàng
                            </a>
                        </div>
                    }
                </div>
            </div>
        </div>

        <div class="col-lg-5 mb-4">
            <div class="card shadow border-0">
                <div class="card-header bg-light py-3">
                    <h6 class="m-0 font-weight-bold text-gray-800">
                        <i class="fas fa-receipt mr-2"></i> ĐƠN HÀNG CỦA BẠN
                    </h6>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-borderless mb-0">
                            <thead class="bg-light text-muted small">
                                <tr>
                                    <th class="pl-4">Sản phẩm</th>
                                    <th class="text-center">SL</th>
                                    <th class="text-right pr-4">Thành tiền</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model)
                                {
                                    <tr class="border-bottom">
                                        <td class="pl-4 align-middle">
                                            <div class="d-flex align-items-center">
                                                <img src="@Url.Content("~/Content/img/" + item.sAnhBia)"
                                                     width="45" height="60" class="rounded border mr-2" style="object-fit: cover;">
                                                <div class="text-truncate" style="max-width: 140px;">
                                                    <span class="d-block small font-weight-bold">@item.sTenSach</span>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="text-center align-middle">x @item.iSoLuong</td>
                                        <td class="text-right pr-4 align-middle font-weight-bold">
                                            @String.Format("{0:0,0}", item.dThanhTien)
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer bg-white p-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="font-weight-bold text-gray-800 m-0">Tổng thanh toán:</h5>
                        <h4 class="font-weight-bold text-danger m-0">
                            @String.Format("{0:0,0} đ", ViewBag.TongTien)
                        </h4>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function chonDiaChi(loai) {
        var txtTen = document.getElementById("HoTenKH");
        var txtSDT = document.getElementById("DienThoaiKH");
        var txtDiaChi = document.getElementById("DiaChiKH");

        // Dữ liệu từ ViewBag
        var tenCu = "@Html.Raw(ViewBag.TenKH)";
        var sdtCu = "@Html.Raw(ViewBag.SDT)";
        var dcCu = "@Html.Raw(ViewBag.DiaChi)";

        if (loai == 1) {
            // Điền lại dữ liệu cũ và KHÓA
            txtTen.value = tenCu;
            txtSDT.value = sdtCu;
            txtDiaChi.value = dcCu;

            txtTen.setAttribute("readonly", "readonly");
            txtSDT.setAttribute("readonly", "readonly");
            txtDiaChi.setAttribute("readonly", "readonly");
        }
        else {
            // Xóa trắng và MỞ KHÓA
            txtTen.value = "";
            txtSDT.value = "";
            txtDiaChi.value = "";

            txtTen.removeAttribute("readonly");
            txtSDT.removeAttribute("readonly");
            txtDiaChi.removeAttribute("readonly");
            txtTen.focus();
        }
    }
</script>